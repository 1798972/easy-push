# 1.背景



# 2.准备

## 2.1 钉钉群选择添加机器人

![image-20250720171544649](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201715709.png)

![image-20250720171614442](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201716507.png)

![image-20250720171636208](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201716269.png)

## 2.2 添加Webhook类机器人

![image-20250720171715649](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201717695.png)

![image-20250720171746767](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201717814.png)

![image-20250720171837768](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201718814.png)

**记录[加签]文本下方的秘钥值，**后续需要使用到。

![image-20250720171947622](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201719670.png)

**记录此处的Webhook地址**，后续需要使用到。

```bash
# 示例地址
https://oapi.dingtalk.com/robot/send?access_token=xxx
```

> 此处的xxx即为配置文件中需要的accessToken值。

![image-20250720172205390](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201722449.png)

经过上面的配置，我们得到了两个信息：

- 签名秘钥
- Webhook地址



# 3.使用

## 3.1 编写配置

![image-20250720173009071](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201730137.png)

```properties
############### 钉钉群文本消息
cn.yang37.easy-push.ding.base-url=https://oapi.dingtalk.com
cn.yang37.easy-push.ding.access-token=xxx
cn.yang37.easy-push.ding.secret=xxx
```

**钉钉群文本消息**需要使用到**3个配置值**。

- base-url：可不填写，或者保持默认的https://oapi.dingtalk.com

  > 此配置项主要针对内网环境需要使用到代理的情况，可替换为代理机的地址信息。

- access-token：WebHook地址中的**AccessToken值**

- secret：添加机器人时的[加签]文本下方**秘钥值**

关于baseUrl和accessToken，会默认做如下规则替换：**{{url}}**/robot/send?access_token=**{{accessToken}}**。

例如，机器人配置界面提供的WebHook地址是：

```bash
https://oapi.dingtalk.com/robot/send?access_token=abc

# 做如下配置
cn.yang37.easy-push.ding.base-url=http://1.1.1.1:9595
cn.yang37.easy-push.ding.access-token=abc
# 则实际的发送地址为
http://1.1.1.1:9595/robot/send?access_token=abc
```



## 3.2 执行发送

```java
@Slf4j
class DingTextTest {

    @Test
    void name1() {
        // 构建消息实体类
        DingTextMessage message = new DingTextMessage("123456789");
        // 执行发送
        MessageContext messageContext = new SendMessageServiceImpl().singleSend(message);
        // 查看发送结果
        log.info("发送结果: {}", messageContext.getState());
    }

    @Test
    void name2() {
        // 构建消息实体类
        DingTextMessage message = new DingTextMessage("123456789\n7654321");
        // 执行发送
        MessageContext messageContext = new SendMessageServiceImpl().singleSend(message);
        // 查看发送结果
        log.info("发送结果: {}", messageContext.getState());
    }
}
```

![image-20250720175248246](https://markdown-1258124344.cos.ap-guangzhou.myqcloud.com/images/202507201752319.png)